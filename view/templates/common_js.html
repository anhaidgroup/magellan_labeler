<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" src=":/qtwebchannel/qwebchannel.js"></script>

<script type="text/javascript">

    var current_page = {{ current_page|int }};


    function change_page(page_number) {
        current_page = page_number;
        new QWebChannel(qt.webChannelTransport, function (channel) {
            {# todo 3/26/17 change function name #}
            channel.objects.pagination_controller.change_page(page_number);
        });

    }

    function change_token_count() {
        var token_count = document.getElementById("token_number_input").value;
        if ($.isNumeric(token_count) && Math.floor(parseInt(token_count, 10)) >= 0) {
            token_count = Math.floor(parseInt(token_count, 10));
            new QWebChannel(qt.webChannelTransport, function (channel) {
                channel.objects.pagination_controller.change_token_count(token_count);
            });
        }
        else {
            alert("Alphabet count value has to be a positive integer (0 or more)");
        }
    }

    function filter_tuples(label) {
        new QWebChannel(qt.webChannelTransport, function (channel) {
            channel.objects.filter_controller.get_filtered_tuple_pairs(label);
        });
    }

    function change_label(tuple_pair_id, new_label) {
        {#            alert(tupleId + " " + newLabel);#}
        new QWebChannel(qt.webChannelTransport, function (channel) {
            document.getElementById(tuple_pair_id).className = "table table-bordered " + new_label;
            channel.objects.label_controller.change_label(tuple_pair_id, new_label);
        });
    }

    function edit_comments(tuple_pair_id, comments) {
        var comments = prompt("Edit comments", comments);
        if (comments == null) comments = "";
        var element = document.getElementById("comments_" + tuple_pair_id);
        element.innerHTML = comments;
        new QWebChannel(qt.webChannelTransport, function (channel) {
            channel.objects.label_controller.edit_comments(tuple_pair_id, comments);
        });
    }

    function edit_tags(tuple_pair_id, tags) {
        var tags = prompt("Enter comma separated tags", tags);
        if (tags == null) tags = "";
        var element = document.getElementById("tags_" + tuple_pair_id);
        element.innerHTML = tags;
        new QWebChannel(qt.webChannelTransport, function (channel) {
            channel.objects.label_controller.edit_tags(tuple_pair_id, tags);
        });
    }

    function change_layout(new_layout) {
        new QWebChannel(qt.webChannelTransport, function (channel) {
            channel.objects.pagination_controller.change_layout(new_layout);
        });
    }

    function filter_attributes() {
        new QWebChannel(qt.webChannelTransport, function (channel) {
            var checkedBoxes = document.querySelectorAll('input[name=attribute_filter]:checked');
            var checkboxesChecked = "";
            for (i = 0; i < checkedBoxes.length; i++) {
                checkboxesChecked = checkboxesChecked.concat(checkedBoxes[i].id);
                checkboxesChecked = checkboxesChecked.concat(",");
            }
            channel.objects.filter_controller.filter_attribute(checkboxesChecked);
        });

    }

    function save_data(save_file_name) {
        if (save_file_name == null || save_file_name == "default_save_file") {
            {# todo: better way to do default file name#}
            var save_file_name = prompt("Please enter your name", save_file_name);
            if (save_file_name == null)
                alert("Save file name can't be empty");
        }
        if (save_file_name != null) {
            alert(save_file_name);
            new QWebChannel(qt.webChannelTransport, function (channel) {
                channel.objects.pagination_controller.save_data(save_file_name);
            });
        }

    }
</script>
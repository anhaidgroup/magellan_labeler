<!DOCTYPE html>
<html lang="en">
<head>
    <title>Title</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/home/pavan/ds_independent_study/magellan_labeller/view/styles/style.css"/>
    <style>
        /*
        todo 3/10/17 change to relative scale
        todo External style sheet
     */

        #left_pane {
            float: left;
            display: inline-block;
        {#            border-style: solid;#}{#            border-w: 1px;#} width: 30%;
            height: 850px;
        }

        #stats_pane {
            margin: 10px auto;
        {#            border-style: dotted;#} height: 50%;
            width: 100%;
            padding-left: 20px;
        }

        #filter_pane {
            margin: 10px auto;
        {#            border-style: dotted;#} height: 50%;
            width: 100%;
            padding-left: 20px;
        }

        #right_pane {
            clear: left;
            display: inline-block;
            background: white;
        {#            border-style: dashed;#} margin-left: 10px;
            width: 65%;
            height: 850px;
        }

        /*todo: label_{label value} check & fix label values*/
        .label_Yes {
            background-color: lightgreen;
            margin-top: 15px;
            width: 100%;
            border: 1px solid black;

        }

        .label_Not-Sure {
            background-color: yellow;
            margin-top: 15px;
            width: 100%;
            border: 1px solid black;

        }

        .label_Not-Matched {
            background-color: lightcoral;
            margin-top: 15px;
            width: 100%;
            border: 1px solid black;
        }

        #save_button {
            margin-top: 15px;
            float: right;
        }

        #mark_matched {
            background: lawngreen;
        }

        #mark_not_sure {
            background: yellow;
        }

        #mark_unmatched {
            background: orangered;
        }

        .tuple_row {
            margin-left: 10px;
        }

        .button_row td {
            width: 33%;
        }

        #pagination {
            float: right;
        }

        .pageNumber {
            color: blue;
        }

        .currentPageNumber {
            color: red;
        }


    </style>

    <script type="text/javascript" src=":/qtwebchannel/qwebchannel.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="../js/jquery.loadTemplate.min.js"></script>
    <script type="text/javascript">
        function filterTuples() {
            new QWebChannel(qt.webChannelTransport, function (channel) {
                channel.objects.filter_controller.get_filtered_tuple_pairs(document.querySelector('.filter:checked').value);
            });
        }

        function changePage(pageNumber) {
            new QWebChannel(qt.webChannelTransport, function (channel) {
                {# todo 3/26/17 change function name #}
                channel.objects.pagination_controller.get_page_html(pageNumber);
            });
        }

        function changeLabel(tupleId, newLabel) {
            {#            alert(tupleId + " " + newLabel);#}
            new QWebChannel(qt.webChannelTransport, function (channel) {
                {# todo 3/26/17 change function name #}
                document.getElementById(tupleId).className = "label_" + newLabel;
                channel.objects.label_controller.change_label(tupleId, newLabel);
            });

        }
        var currentPage = {{ currentPage|int }};
        {# initialize with values from Jinja #}
        var countPerPage = {{ countPerPage|int }};
        var numberOfPages = {{ numberOfPages|int }};

    </script>
</head>
<body>
<h1>Main window</h1>

<div id="left_pane">
    <div id="stats_pane">
        <h5> Stats </h5>
        <p>
            Matched: {{ matched_count }}
        </p>
        <p>
            Non Matching: {{ unmatched_count }}
        </p>
        <p>
            Total: {{ total_count }}
        </p>
    </div>
    <div id="filter_pane">
        <h5>Filter tuple pairs by label</h5>
        <form action="">
            <input type="radio" class="filter" name="filter" value="Yes"> Matched<br>
            <input type="radio" class="filter" name="filter" value="Not-Matched"> Not Matched<br>
            <input type="radio" class="filter" name="filter" value="Not-Sure"> Not Sure <br>
            <input type="button" onclick=filterTuples() value="Filter">
        </form>
    </div>
</div>

{# todo: Remove hard coding!!#}
<div id="right_pane">
    <div id="tuple_pairs" class="tuple_pairs">
        <h5>Tuple pairs</h5>
        {% for row in data %}
            <table class={{ "label_"+row['label'] }} id={{ row['_id'] }}>
                <tr class="tuple_row">
                    <td rowspan="2">{{ row['_id'] }}</td>
                    <td>{{ row['ltable.ID'] }}</td>
                    <td>{{ row['ltable.birth_year'] }}</td>
                    <td>{{ row['ltable.name'] }}</td>
                </tr>
                <tr class="tuple_row">
                    <td>{{ row['rtable.ID'] }}</td>
                    <td>{{ row['rtable.birth_year'] }}</td>
                    <td>{{ row['rtable.name'] }}</td>
                </tr>
                <tr class="button_row">
                    <td>
                        <button id="mark_matched" onclick="changeLabel({{ row['_id'] }},'Yes')">Yes</button>
                    </td>
                    <td>
                        <button id="mark_not_sure" onclick="changeLabel({{ row['_id'] }}, 'Not-Sure')">Not-Sure</button>
                    </td>
                    <td>
                        <button id="mark_unmatched" onclick="changeLabel({{ row['_id'] }}, 'Not-Matched')">Not-Matched
                        </button>
                    </td>
                </tr>
            </table>
        {% endfor %}

    </div>
    <button id="save_button">Save and Continue</button>
    <div id="pagination">
        {% for i in range(numberOfPages) %}
            {% if currentPage == i %}
                <a class="currentPageNumber" onclick=changePage({{ i }});>{{ i }}</a>
            {% else %}
                <a class="pageNumber" onclick=changePage({{ i }});>{{ i }}</a>
            {% endif %}
        {% endfor %}
    </div>
</div>
</body>
</html>
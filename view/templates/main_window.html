<!DOCTYPE html>
<html lang="en">
<head>
    <title>Title</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/home/pavan/ds_independent_study/magellan_labeller/view/styles/style.css"/>
    <style>
        /*
        todo 3/10/17 change to relative scale
        todo External style sheet
     */

        body {
            font-family: sans-serif;
        }

        h5 {
            font-family: monospace;
            font-weight: normal;
            font-size: large;
        }

        #left_pane {
            float: left;
            display: inline-block;
            width: 20%;
            height: auto;
            padding-right: 20px;
        }

        #stats_pane {
            margin: 10px auto;
            height: 50%;
            width: 100%;
            padding-left: 20px;
            margin-bottom: 30px;
        }

        #filter_pane {
            /*margin: 10px auto;*/
            height: 50%;
            width: 100%;
            padding-left: 20px;
            border-top: 1px solid;
        }

        #right_pane {
            clear: left;
            display: inline-block;
            background: white;
            margin-left: 10px;
            width: 75%;
            height: 850px;
        }

        /*todo: label_{label value} check & fix label values*/
        .label_Yes {
            background-color: lightgreen;
            margin-top: 15px;
            width: 100%;

        }

        .label_Not-Sure {
            background-color: yellow;
            margin-top: 15px;
            width: 100%;

        }

        .label_Not-Matched {
            background-color: lightcoral;
            margin-top: 15px;
            width: 100%;
        }

        .change_button {
            margin-right: 15px;
        }

        #filter_button {
            margin-top: 15px;
            width: 50px;
        }

        #save_button {
            margin-top: 15px;
            clear: both;
            float: right;
            padding-top: 5px;
        }

        #mark_matched {
            background: lawngreen;
        }

        #mark_not_sure {
            background: yellow;
        }

        #mark_unmatched {
            background: orangered;
        }

        .tuple_row {
            margin-left: 10px;
            border: 1px solid black;
        }

        .button_row {
            width: 100%;
            text-align: center;
            margin-top: 5px;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid black;
        }

        #pagination {
            float: right;
            border: 3px;
            padding: 5px;
        }

        .page_number {
            color: blue;
            font-size: 125%;
        }

        .current_page_number {
            color: red;
            text-decoration: underline;
            font-size: 150%;
        }


    </style>

    <script type="text/javascript" src=":/qtwebchannel/qwebchannel.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="../js/jquery.loadTemplate.min.js"></script>
    <script type="text/javascript">
        function filterTuples() {
            new QWebChannel(qt.webChannelTransport, function (channel) {
                channel.objects.filter_controller.get_filtered_tuple_pairs(document.querySelector('.filter:checked').value);
            });
        }

        function changePage(pageNumber) {
            currentPage = pageNumber;
            new QWebChannel(qt.webChannelTransport, function (channel) {
                {# todo 3/26/17 change function name #}
                channel.objects.pagination_controller.get_page_html(pageNumber);
            });
        }

        function changeLabel(tupleId, newLabel) {
            {#            alert(tupleId + " " + newLabel);#}
            new QWebChannel(qt.webChannelTransport, function (channel) {
                {# todo 3/26/17 change function name #}
                document.getElementById(tupleId).className = "label_" + newLabel;
                channel.objects.label_controller.change_label(tupleId, newLabel);
            });

        }
        var currentPage = {{ currentPage|int }};
        {# initialize with values from Jinja #}
        var countPerPage = {{ countPerPage|int }};
        var numberOfPages = {{ numberOfPages|int }};

    </script>
</head>
<body>

<div id="left_pane">
    <div id="stats_pane">
        <h5> Number of tuples </h5>
        <table border="1">
            <tr>
                <td>Matched</td>
                <td>{{ matched_count }}</td>
            </tr>
            <tr>
                <td>Non Matching:</td>
                <td>{{ unmatched_count }}</td>
            </tr>
            <tr>
                <td>Non Sure:</td>
                <td>{{ not_sure_count }}</td>
            </tr>
            <tr>
                <td>Total:</td>
                <td>{{ total_count }}</td>
            </tr>
        </table>
    </div>
    <div id="filter_pane">
        <h5>Filter tuple pairs by label</h5>
        <form action="">
            <table border="2" id="filter_options">
                <tr>
                    <td><input type="radio" class="filter" name="filter" value="Yes"></td>
                    <td>Matched</td>
                </tr>
                <tr>
                    <td><input type="radio" class="filter" name="filter" value="Not-Matched"></td>
                    <td>Not Matched</td>
                </tr>
                <tr>
                    <td><input type="radio" class="filter" name="filter" value="Not-Sure"></td>
                    <td>Not Sure</td>
                </tr>
                <tr>
                    <td><input type="radio" class="filter" name="filter" value="All"></td>
                    <td>Show All</td>
                </tr>
            </table>
            <input type="button" id="filter_button" onclick=filterTuples() value="Filter">

        </form>
    </div>
</div>

{# todo: Remove hard coding!!#}
<div id="right_pane">
    <div id="tuple_pairs" class="tuple_pairs">
        <h5>{{ display_title }}</h5>
        {% for row in data %}
            <table class={{ "label_"+row['label'] }} id={{ row['_id'] }}>
                <tr class="tuple_row">
                    <td rowspan="2">{{ row['_id'] }}</td>
                    <td>{{ row['ltable.ID'] }}</td>
                    <td>{{ row['ltable.birth_year'] }}</td>
                    <td>{{ row['ltable.name'] }}</td>
                </tr>
                <tr class="tuple_row">
                    <td>{{ row['rtable.ID'] }}</td>
                    <td>{{ row['rtable.birth_year'] }}</td>
                    <td>{{ row['rtable.name'] }}</td>
                </tr>
            </table>
            <div class="button_row">
                <button id="mark_matched" class="change_button" onclick="changeLabel({{ row['_id'] }},'Yes')">Yes
                </button>
                <button id="mark_not_sure" class="change_button" onclick="changeLabel({{ row['_id'] }}, 'Not-Sure')">
                    Not-Sure
                </button>
                <button id="mark_unmatched" class="change_button" onclick="changeLabel({{ row['_id'] }},'Not-Matched')">
                    Not-Matched
                </button>
            </div>
        {% endfor %}

    </div>
    <button id="save_button">Save and Continue</button>
    <div id="pagination">
        {% for i in range(numberOfPages) %}
            {% if currentPage == i %}
                <a class="current_page_number" onclick=changePage({{ i }});>{{ i }}</a>
            {% else %}
                <a class="page_number" onclick=changePage({{ i }});>{{ i }}</a>
            {% endif %}
        {% endfor %}
    </div>
</div>
</body>
</html>